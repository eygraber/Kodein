package org.kodein.di

import org.kodein.di.test.FixMethodOrder
import org.kodein.di.test.MethodSorters
import org.kodein.di.test.Person
import kotlin.test.Test
import kotlin.test.assertEquals

@FixMethodOrder(MethodSorters.NAME_ASCENDING)
class GenericJvmTests_17_NewInstance {

    class Wedding(val him: Person, val her: Person)

    @Test
    fun test_00_NewInstance() {
        val kodein = DI {
            bind<Person>(tag = "Author") with scopedSingleton { Person("Salomon") }
            bind<Person>(tag = "Spouse") with scopedSingleton { Person("Laila") }
        }

        val wedding by kodein.newInstance { Wedding(instance(tag = "Author"), instance(tag = "Spouse")) }
        assertEquals("Salomon", wedding.him.name)
        assertEquals("Laila", wedding.her.name)
    }

    @Test
    fun test_01_DirectNewInstance() {
        val kodein = DI.direct {
            bind<Person>(tag = "Author") with scopedSingleton { Person("Salomon") }
            bind<Person>(tag = "Spouse") with scopedSingleton { Person("Laila") }
        }

        val wedding = kodein.newInstance { Wedding(instance(tag = "Author"), instance(tag = "Spouse")) }
        assertEquals("Salomon", wedding.him.name)
        assertEquals("Laila", wedding.her.name)
    }


}
